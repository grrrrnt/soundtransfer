<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <title>Authorization with Spotify</title>
  </head>
  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <div class="container">
      <h1 class="">Music Streaming Adapter</h1>
      <h3 class="">Authorization with Spotify</h3>
      <p>Please click this button to connect with your Spotify account</p>
      <div>
        <button class="btn btn-primary" id="authorizeButton">
          Authorize with Spotify
        </button>
      </div>
    </div>
    <script>
      let isSpotifyAPIConfigured = false;
      const clientId = new URLSearchParams(window.location.search).get(
        "clientId"
      );
      if (clientId == null) {
        document.querySelector("#authorizeButton").disabled = true;
      } else {
        isSpotifyAPIConfigured = true;
      }

      document.querySelector("#authorizeButton").onclick = async () => {
        if (isSpotifyAPIConfigured) {
          try {
            const data = await fetch("/api/spotify/user-auth", {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
              mode: "no-cors",
            });

            window.location.href = await data.text();
          } catch (err) {
            alert(`Error ${err}`);
          }
        } else {
          alert("Spotify API not ready yet");
        }
      };
    </script>
  </body>
</html>
